/*!
 * timbre.mp3_decode.js
 * http://skratchdot.com/projects/timbre.mp3_decode.js/
 *
 * Copyright (c) 2013 skratchdot
 * Licensed under the MIT license.
 */
"undefined"!=typeof timbre&&"undefined"!=typeof Mad&&"browser"===timbre.envtype&&function(t){t.modules.Decoder.mp3_decode=function(){var e=function(t,e,i){var n,s,r,a,o,u,h,l,c,f,p,d,m,v,g,b,_=0,y=[],w=0;try{for(a=new Mad.ArrayBuffers.ArrayStream(t),o=new Mad.MP3File(a),u=o.getMpegStream(),h=new Mad.Synth,l=new Mad.Frame,l=Mad.Frame.decode(l,u);null!==l;){if(h.frame(l),b||(c=h.pcm.channels,f=h.pcm.samplerate,b=!0),_+=h.pcm.length,y.push({mixdown:void 0,bufferL:void 0,bufferR:void 0}),y[w].mixdown=new Float32Array(h.pcm.length),2===c)for(y[w].bufferL=new Float32Array(h.pcm.length),y[w].bufferR=new Float32Array(h.pcm.length),n=0;h.pcm.length>n;n++)r=y[w].bufferL[n]=h.pcm.samples[0][n],r+=y[w].bufferR[n]=h.pcm.samples[1][n],y[w].mixdown[n]=.5*r;else if(1===c)for(n=0;h.pcm.length>n;n++)y[w].mixdown[n]=h.pcm.samples[0][n];l=Mad.Frame.decode(l,u),w++}}catch(x){}if(0===_||1>c||c>2)return e(!1);for(m=new Float32Array(_),2===c&&(v=new Float32Array(_),g=new Float32Array(_)),e({samplerate:f,channels:c,buffer:[m,v,g],duration:_/f}),d=0,n=0;y.length>n;n++)for(p=y[n],s=0;p.mixdown.length>s;s++)m[d]=p.mixdown[s],2===c&&(v[d]=p.bufferL[s],g[d]=p.bufferR[s]),d++;i()};return function(i,n,s){"string"==typeof i?t.modules.Decoder.getBinaryWithPath(i,function(t){e(t,n,s)}):e(i,n,s)}}()}(timbre);