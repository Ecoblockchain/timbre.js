/*!
 * timbre.soundfont.js
 * http://skratchdot.com/projects/timbre.soundfont.js/
 *
 * Copyright (c) 2013 skratchdot
 * Licensed under the MIT license.
 */
(function(){"use strict";var t,e,i={},n=5e3,s="https://free-midi.googlecode.com/git/channel/0/instrument/{instrument}/{note}.js?_callback=soundfont_0_{instrument}_{note}",r="gm",a=0,o=0,u=64,h=!0,l={};t=function(t){l.hasOwnProperty(r)||(l[r]={}),l[r].hasOwnProperty(a)||(l[r][a]={}),l[r][a].hasOwnProperty(o)||(l[r][a][o]={}),l[r][a][o].hasOwnProperty(u)||(l[r][a][o][u]={}),l[r][a][o][u].hasOwnProperty(t)||(l[r][a][o][u][t]={sample:null,isLoading:!1,loadTime:(new Date).getTime(),callbacks:[]})},e=function(e,c){var f,p;if(t(e),f=l[r][a][o][u][e],null!==f.sample)c(f,!0);else if(f.isLoading&&n>(new Date).getTime()-f.loadTime)f.callbacks.push(c);else{f.isLoading=!0;try{p=s.replace(/\{name\}/gi,r).replace(/\{channel\}/gi,a).replace(/\{instrument\}/gi,o).replace(/\{length\}/gi,u).replace(/\{note\}/gi,e),timbre("audio"+(h?".jsonp":"")).loadthis(p,function(){var t,n;for(f.sample=this,t=0;f.callbacks.length>t;t++)n=f.callbacks[t],"function"==typeof n&&n(f,!1);f.callbacks=[],f.isLoading=!1,c(f,!1),i.onLoad(f,e)},function(){throw Error('T("audio").loadthis() error.')}).on("ended",function(){f.sample.pause()})}catch(d){f.isLoading=!1,f.sample=null,f.callbacks.push(c),i.onError(d,e)}}},i.emptyCache=function(){l={}},i.setUrlTemplate=function(t){i.emptyCache(),s=t},i.setName=function(t){r=t},i.setChannel=function(t){a=t},i.setInstrument=function(t){o=t},i.setLength=function(t){u=t},i.setJsonp=function(t){h=t===!0?!0:!1},i.preload=function(t){var i,n=function(){};for(i=0;t.length>i;i++)e(t[i],n)},i.play=function(t,i,n){i=i===!1?!1:!0,n="object"==typeof n?n:{},e(t,function(t,e){(e||i)&&t.sample.set(n).play().bang()})},i.onError=function(){},i.onLoad=function(){},timbre&&timbre.modules&&timbre.modules.Decoder&&timbre.modules.Decoder.mp3_decode&&"browser"===timbre.envtype&&(timbre.soundfont=i)})();