!function(a){"use strict";function b(b){a.Object.call(this,2,b),c.fixAR(this);var f=this._;f.mode="",f.bufferL=new c.SignalArray(e<<2),f.bufferR=new c.SignalArray(e<<2),f.buffermask=f.bufferL.length-1,f.node=null,f.script=d.createJavaScriptNode(e,2,2),f.writeIndex=0,f.readIndex=0,f.totalRead=0,f.totalWrite=0}if("webkit"===a.env){var c=a.fn,d=c._audioContext,e=1024;c.extend(b);var f=b.prototype;Object.defineProperties(f,{context:{get:function(){return d}},mode:{get:function(){return this._.mode}}}),f.cancel=function(){for(var a=this._,b=this.cells[0],c=0,d=b.length;d>c;++c)b[c]=0;a.node=null},function(){function a(a){b.call(this,a);var c=this._;c.mode="recv",c.script.onaudioprocess=e(this),c.gain=d.createGainNode(),c.gain.gain.value=0,c.script.connect(c.gain)}c.extend(a,b);var e=function(a){return function(b){var c=a._,d=b.inputBuffer,e=d.getChannelData(0),f=d.getChannelData(1),g=d.length,h=c.writeIndex;c.bufferL.set(e,h),c.bufferR.set(f,h),c.writeIndex=h+g&c.buffermask,c.totalWrite+=g}},f=a.prototype;f.cancel=function(){b.prototype.cancel.call(this),this._.gain.disconnect(),this._.node&&this._.node.disconnect()},f.recv=function(a){var b=this._;try{b.node=a,b.node.connect(b.script),b.gain.connect(d.destination)}catch(c){b.node=null}return b.writeIndex=0,b.readIndex=0,b.totalWrite=0,b.totalRead=0,this},f.process=function(a){var b=this._;if(null===b.node)return this;if(this.tickID!==a){this.tickID=a;var d=b.cellsize,e=b.bufferL,f=b.bufferR;if(b.totalWrite>b.totalRead+d){var g=b.readIndex,h=g+d;this.cells[1].set(e.subarray(g,h)),this.cells[2].set(f.subarray(g,h)),b.readIndex=h&b.buffermask,b.totalRead+=d}c.outputSignalAR(this)}return this},c.register("WebAudioAPI:recv",a)}(),function(){function a(a){b.call(this,a),c.listener(this);var e=this._;e.mode="send",e.script.onaudioprocess=d(this),e.connectIndex=null}c.extend(a,b);var d=function(a){return function(b){var c=a._,d=b.outputBuffer,e=d.length;if(c.totalWrite>c.totalRead+e){var f=c.readIndex,g=f+e;d.getChannelData(0).set(c.bufferL.subarray(f,g)),d.getChannelData(1).set(c.bufferR.subarray(f,g)),c.readIndex=g&c.buffermask,c.totalRead+=e}}},e=a.prototype;e.cancel=function(){b.prototype.cancel.call(this);var a=this._;null!==a.connectIndex?a.script.disconnect(a.connectIndex):a.script.disconnect(),this.unlisten()},e.send=function(a,b){var c=this._;try{c.node=a,"number"==typeof b?(c.script.connect(c.node,b),c.connectIndex=b):(c.script.connect(c.node),c.connectIndex=null),this.listen()}catch(d){c.node=null}return c.writeIndex=0,c.readIndex=0,c.totalWrite=0,c.totalRead=0,this},e.process=function(a){var b=this._;if(null===b.script)return this;if(this.tickID!==a){this.tickID=a;var d=this.cells[1],e=this.cells[2],f=b.cellsize,g=b.writeIndex;c.inputSignalAR(this),b.bufferL.set(d,g),b.bufferR.set(e,g),b.writeIndex=g+f&b.buffermask,b.totalWrite+=f,c.outputSignalAR(this)}return this},c.register("WebAudioAPI:send",a)}()}}(timbre);